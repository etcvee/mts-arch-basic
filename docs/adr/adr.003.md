#  ADR.003 Переход на MongoDB

* Статус: Принято
* Владелец: ntkrnlmp@yandex.ru

## Контекст
В текущей реализации все сервисы используют РСУБД MariaDB.
Было предложено отказаться от использования MariaDB в пользу NoSQL решения, а именно MongoDB. Необходимо проанализировать целесообразность такого изменения.

## Варианты решения

### MongoDB
MongoDB — документоориентированная система управления базами данных, не требующая описания схемы таблиц. Является NoSQL-системой, использует JSON-подобные документы и схему базы данных. Система масштабируется горизонтально (шардирование). Начиная с версии 4.0 есть поддержка ACID.

### MariaDB
MariaDB — форк РСУБД MySQL, обеспечивающий высокий уровень совместимости с MySQL. Поддерживает несколько типов движков, таких как MyISAM, InnoDB, Maria (устойчивый ко сбоям клон MyISAM), практически полностью реализует стандарт ANSI SQL 2003. Масштабируется в основном вертикально.

### Сравнение баз данных

| Критерий                       | MariaDB      | MongoDB        |
| ------------------------------ | ------------ | -------------- |
| Модель данных                  | Реляционная  | Документная    |
| Поддержка ACID                 | Да           | Да             |
| Классификация по CAP           | CA/CP        | AP/CP          |
| Масштабирование (из коробки)   | Вертикальное | Горизонтальное |
| Коэффициент производительности | 1            | 2-3            |


## Решение
Миграция на MongoDB имеет смысл для сервисов, для которых не требуются строгая консистентность и для которых приемлем (адекватный) риск потери данных. В качестве такого сервиса может выступать сервис авторов - в случае сбоя базы данных после регистрации нового пользователя с высокой долей вероятность пользователь еще не успел приступить к работе с системой (не загрузил презентации), поэтому потеря данных приведет только к необходимости повторной регистрации. При наличие отдельной системы аудита можно будет восстановить пользователей в автоматическом режиме.

Для сервисов, для которых важна целостность и сохранность данных, следует продолжать использовать РСУБД, а для повышения производительности использовать кеширование.

## Последствия

Использование MongoDB для некоторых сервисов повлечет за собой необходимость в обучении команды эксплуатации администрированию MongoDB, а при наличии требований обязательной поддержки с гарантированным SLA - к дополнительным эксплуатационным затратам.

Использование schemaless NoSQL решения с одной стороны позволит сократить Time to Market за счет отсутствия необходимости в миграции схемы данных, а с другой стороны потребует от разработчиков учитывать наличие разных схем данных в коде приложение. Так же появляется риск превращения базы данных в неуправляемое с точки зрения структуры данных хранилище (экстремальный случай - все документы одной коллекции имеют разную, несовместимую между собой структуру).

Использование MongoDB снижает требования к квалификации разработчиков, т.к. от них более не требуется знаний реляционной модели и наличия навыков проектирования баз данных. Тем не менее, это не избавляет от необходимости продумывания схемы данных и стратегии её эволюционирования.